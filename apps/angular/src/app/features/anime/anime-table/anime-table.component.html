<ng-container *ngIf="(result$ | async) as animeList; else Loading">
  <div class="filter">
    <mat-form-field appearance="fill" class="filter__item">
      <mat-label>Choose an sorting option</mat-label>
      <mat-select [value]="(settingOfAnimeList$ | async)?.sortBy" (selectionChange)="handleSortByChange($event)">
        <mat-option *ngFor="let item of sortingOptions" [value]="item.value">{{item.title}}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill" class="filter__item">
      <mat-label>Choose ordering</mat-label>
      <mat-select
      [value]="(settingOfAnimeList$ | async)?.ordering"
      (selectionChange)="handleOrderingChange($event)">
      <mat-option *ngFor="let item of orderingOptions" [value]="item.value">{{item.title}}</mat-option>
      </mat-select>
    </mat-form-field>

    <ng-container *ngIf="(settingOfAnimeList$ | async)?.type as multipleType" >
      <mat-form-field appearance="fill" class="filter__item">
        <mat-label>Choose type</mat-label>
        <mat-select [value]="multipleType" (selectionChange)="handleTypeChange($event)" multiple>
          <mat-select-trigger>
            {{multipleType[0] || ''}}
            <span *ngIf="(multipleType.length || 0) > 1" class="example-additional-selection">
              (+{{(multipleType.length || 0) - 1}} {{multipleType.length === 2 ? 'other' : 'others'}})
            </span>
          </mat-select-trigger>
          <mat-option *ngFor="let topping of filterTypeOptions;" [value]="topping.value">{{topping.title}}</mat-option>
        </mat-select>
      </mat-form-field>
    </ng-container>
  </div>

  <mat-form-field class="search">
    <mat-label>Search</mat-label>
    <input type="search" matInput [value]="search$ | async" (keyup)="handleInputSearch($event)"
    placeholder="Search title anime ... ">
  </mat-form-field>

  <camp-pagination [activePage]="(settingOfAnimeList$ | async)?.page" [totalItems]="totalItems$| async" (pageChange)="handlePageChange($event)"></camp-pagination>
  <table mat-table [dataSource]="animeList.results" class="table">

    <ng-container matColumnDef="image">
      <th class="table__cell table__cell_title" mat-header-cell *matHeaderCellDef> Image </th>
      <td [ngStyle]="{paddingLeft: 0}" class="table__cell_thumb" mat-cell *matCellDef="let element">
        <img class="table__img" [src]="element.image"/>
      </td>
    </ng-container>

    <ng-container matColumnDef="titleEnglish">
      <th class="table__cell table__cell_title" mat-header-cell *matHeaderCellDef> English title</th>
      <td class="table__cell" mat-cell *matCellDef="let element"> {{element.titleEnglish}} </td>
    </ng-container>

    <ng-container matColumnDef="titleJapan">
      <th class="table__cell table__cell_title" mat-header-cell *matHeaderCellDef>Japanese title</th>
      <td class="table__cell" mat-cell *matCellDef="let element"> {{element.titleJapan}} </td>
    </ng-container>

    <ng-container matColumnDef="airedStartDate">
      <th class="table__cell table__cell_title" mat-header-cell *matHeaderCellDef> Aired start </th>
      <td class="table__cell" mat-cell *matCellDef="let element"> {{element.aired.start ? element.aired.start.toLocaleDateString() : ''}} </td>
    </ng-container>

    <ng-container matColumnDef="type">
      <th class="table__cell table__cell_title" mat-header-cell *matHeaderCellDef> Type </th>
      <td class="table__cell" mat-cell *matCellDef="let element"> {{element.type}} </td>
    </ng-container>

    <ng-container matColumnDef="status">
      <th class="table__cell table__cell_title" mat-header-cell *matHeaderCellDef> Type </th>
      <td class="table__cell" mat-cell *matCellDef="let element"> {{element.status}} </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>

<!--
  <table class="table">
    <caption class="table__caption">Anime table</caption>
    <tr class="table__row table__row_caption">
      <th scope="row" class="table__cell">Thumbnail</th>
      <th scope="row" class="table__cell">English title</th>
      <th scope="row" class="table__cell">Japanese title</th>
      <th scope="row" class="table__cell">Aired start</th>
      <th scope="row" class="table__cell">Type</th>
      <th scope="row" class="table__cell">Status</th>
    </tr>
    <tr *ngFor="let item of animeList.results; trackBy: trackByAnime" class="table__row">
      <th scope="row" class="table__cell table__cell_thumb">
        <img class= "table__img" [src]="item.image" [alt]="item.titleEnglish" />
      </th>
      <th scope="row" class="table__cell">{{item.titleEnglish}}</th>
      <th scope="row" class="table__cell">{{item.titleJapan}}</th>
      <th scope="row" class="table__cell">{{item.aired.start ? item.aired.start.toLocaleDateString() : ''}}</th>
      <th scope="row" class="table__cell">{{item.type}}</th>
      <th scope="row" class="table__cell">{{item.status}}</th>
    </tr>
  </table> -->
</ng-container>

<ng-template #Loading>
  <div ngClass="loading">
    <mat-spinner></mat-spinner>
  </div>
</ng-template>

