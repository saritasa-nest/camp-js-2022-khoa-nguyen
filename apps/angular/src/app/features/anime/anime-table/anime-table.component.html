<ng-container *ngIf="(result$ | async) as animeList; else Loading">
  <camp-pagination [activePage]="activePage$ | async" [totalItems]="totalItems$| async" (pageChange)="handlePageChange($event)"></camp-pagination>
  <div class="filter">
    <mat-form-field appearance="fill" class="filter__item">
      <mat-label>Choose an sorting option</mat-label>
      <mat-select [value]="sortBy$ | async" (selectionChange)="handleSortByChange($event)">
        <mat-option *ngFor="let item of sortingOptions" [value]="item.value">{{item.title}}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill" class="filter__item">
      <mat-label>Choose ordering</mat-label>
      <mat-select [value]="ordering$ | async" (selectionChange)="handleOrderingChange($event)">
        <mat-option *ngFor="let item of orderingOptions" [value]="item.value">{{item.title}}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill" class="filter__item">
      <mat-label>Choose type</mat-label>
      <mat-select [formControl]="types" multiple>
        <mat-select-trigger>
          {{types.value?.[0] || ''}}
          <span *ngIf="(types.value?.length || 0) > 1" class="example-additional-selection">
            (+{{(types.value?.length || 0) - 1}} {{types.value?.length === 2 ? 'other' : 'others'}})
          </span>
        </mat-select-trigger>
        <mat-option *ngFor="let topping of filterTypeOptions;" [value]="topping.value">{{topping.title}}</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <mat-form-field class="search">
    <mat-label>Search</mat-label>
    <input type="text" matInput [formControl]="search"
           placeholder="Search title anime ... ">
  </mat-form-field>

  <table class="table">


    <caption class="table__caption">Anime table</caption>
    <tr class="table__row table__row_caption">
      <th scope="row" class="table__cell">Thumbnail</th>
      <th scope="row" class="table__cell">English title</th>
      <th scope="row" class="table__cell">Japanese title</th>
      <th scope="row" class="table__cell">Aired start</th>
      <th scope="row" class="table__cell">Type</th>
      <th scope="row" class="table__cell">Status</th>
    </tr>
    <tr *ngFor="let item of animeList.results; trackBy: trackByAnime" class="table__row">
      <th scope="row" class="table__cell table__cell_thumb">
        <img class= "table__img" [src]="item.image" [alt]="item.titleEnglish" />
      </th>
      <th scope="row" class="table__cell">{{item.titleEnglish}}</th>
      <th scope="row" class="table__cell">{{item.titleJapan}}</th>
      <th scope="row" class="table__cell">{{item.aired.start ? item.aired.start.toLocaleDateString() : ''}}</th>
      <th scope="row" class="table__cell">{{item.type}}</th>
      <th scope="row" class="table__cell">{{item.status}}</th>
    </tr>
  </table>
</ng-container>

<ng-template #Loading>
  <div ngClass="loading">
    <mat-spinner></mat-spinner>
  </div>
</ng-template>

